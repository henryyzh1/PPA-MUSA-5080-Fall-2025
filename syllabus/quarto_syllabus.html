<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dr.&nbsp;Elizabeth Delmelle">
<meta name="dcterms.date" content="2025-08-24">

<title>MUSA 5080 / CPLN 5920: Public Policy Analytics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="quarto_syllabus_files/libs/clipboard/clipboard.min.js"></script>
<script src="quarto_syllabus_files/libs/quarto-html/quarto.js"></script>
<script src="quarto_syllabus_files/libs/quarto-html/popper.min.js"></script>
<script src="quarto_syllabus_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="quarto_syllabus_files/libs/quarto-html/anchor.min.js"></script>
<link href="quarto_syllabus_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="quarto_syllabus_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="quarto_syllabus_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="quarto_syllabus_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="quarto_syllabus_files/libs/bootstrap/bootstrap-10daa034703793678e481cc8cee6d76f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


<link rel="stylesheet" href="styles.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#course-information" id="toc-course-information" class="nav-link active" data-scroll-target="#course-information">Course Information</a></li>
  <li><a href="#course-description" id="toc-course-description" class="nav-link" data-scroll-target="#course-description">Course Description</a></li>
  <li><a href="#learning-outcomes" id="toc-learning-outcomes" class="nav-link" data-scroll-target="#learning-outcomes">Learning Outcomes</a></li>
  <li><a href="#course-materials" id="toc-course-materials" class="nav-link" data-scroll-target="#course-materials">Course Materials</a></li>
  <li><a href="#assessment-structure" id="toc-assessment-structure" class="nav-link" data-scroll-target="#assessment-structure">Assessment Structure</a></li>
  <li><a href="#course-format" id="toc-course-format" class="nav-link" data-scroll-target="#course-format">Course Format</a></li>
  <li><a href="#weekly-schedule" id="toc-weekly-schedule" class="nav-link" data-scroll-target="#weekly-schedule">Weekly Schedule</a></li>
  <li><a href="#academic-integrity-ai-policy" id="toc-academic-integrity-ai-policy" class="nav-link" data-scroll-target="#academic-integrity-ai-policy">Academic Integrity &amp; AI Policy</a></li>
  <li><a href="#additional-faq-information" id="toc-additional-faq-information" class="nav-link" data-scroll-target="#additional-faq-information">Additional FAQ Information</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">MUSA 5080 / CPLN 5920: Public Policy Analytics</h1>
<p class="subtitle lead">Fall 2025</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Dr.&nbsp;Elizabeth Delmelle </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 24, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="course-information" class="level2">
<h2 class="anchored" data-anchor-id="course-information">Course Information</h2>
<p><strong>Time:</strong> Mondays, 10:15 AM – 1:14 PM<br>
<strong>Location:</strong> Fagin 214<br>
<strong>Instructor:</strong> Dr.&nbsp;Elizabeth Delmelle<br>
<strong>Email:</strong> <a href="mailto:delmelle@design.upenn.edu">delmelle@design.upenn.edu</a><br>
<strong>Office Hours:</strong> Mondays 1:30–3:00 PM/ Tuesdays 9:30-10:30am or by appointment <a href="https://calendly.com/delmelle/open-house-office-hours"><em>Use Link To Sign Up</em></a><br>
<strong>TA Office Hours:</strong></p>
<ul>
<li>Jiayue Ma (majiayue@design.upenn.edu): Thursdays 10-11am</li>
<li>Zhanchao Yang (zhanchao@design.upenn.edu): Tuesdays 1-2pm</li>
</ul>
</section>
<section id="course-description" class="level2">
<h2 class="anchored" data-anchor-id="course-description">Course Description</h2>
<p>This course teaches advanced spatial analysis and introduces data science and machine learning tools within the context of urban planning and public policy. Unlike private-sector data science focused solely on optimization, our approach emphasizes public goods, governance, and equity. We’ll cover topics including transportation, housing, public health, and criminal justice, using both spatial tools and predictive modeling to help guide resource allocation and policy design.</p>
<p><strong>Key Focus:</strong> Understanding concepts deeply rather than just completing code. We emphasize fairness, transparency, and understanding the implications of our models.</p>
<hr>
</section>
<section id="learning-outcomes" class="level2">
<h2 class="anchored" data-anchor-id="learning-outcomes">Learning Outcomes</h2>
<p>By the end of the semester, students will be able to:</p>
<ul>
<li>Build and evaluate predictive models for public policy questions</li>
<li>Critically assess model generalizability, effectiveness, and bias<br>
</li>
<li>Navigate the full data science workflow: wrangling, exploration, modeling, and communication</li>
<li>Integrate spatial and temporal variables into policy-oriented models</li>
<li>Communicate uncertainty, limitations, and equity impacts to decision-makers</li>
<li>Create professional data science portfolios using Quarto</li>
</ul>
<hr>
</section>
<section id="course-materials" class="level2">
<h2 class="anchored" data-anchor-id="course-materials">Course Materials</h2>
<section id="required-texts-all-free-online" class="level3">
<h3 class="anchored" data-anchor-id="required-texts-all-free-online">Required Texts (All Free Online)</h3>
<ul>
<li>Ken Steif, <a href="https://urbanspatial.github.io/PublicPolicyAnalytics/"><em>Public Policy Analytics</em></a></li>
<li>Hadley Wickham et al., <a href="https://r4ds.hadley.nz/"><em>R for Data Science</em></a></li>
<li>Robin Lovelace et al., <a href="https://r.geocompx.org/"><em>Geocomputation with R</em></a></li>
<li>Kyle Walker, <a href="https://walker-data.com/census-r/"><em>Analyzing US Census Data</em></a></li>
</ul>
</section>
<section id="supplemental-material" class="level3">
<h3 class="anchored" data-anchor-id="supplemental-material">Supplemental Material</h3>
<ul>
<li>Selected chapters from <a href="https://vis4sds.github.io/vis4sds/"><em>Visualization for Social Data Science</em></a></li>
<li>Additional readings provided weekly via Canvas</li>
</ul>
<hr>
</section>
</section>
<section id="assessment-structure" class="level2">
<h2 class="anchored" data-anchor-id="assessment-structure">Assessment Structure</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 27%">
<col style="width: 38%">
</colgroup>
<thead>
<tr class="header">
<th>Component</th>
<th>Weight</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Weekly In-Class Quizzes</strong></td>
<td>35%</td>
<td>Concept-focused assessments (10 quizzes, lowest score dropped)</td>
</tr>
<tr class="even">
<td><strong>Lab Assignments (5 total)</strong></td>
<td>20%</td>
<td>Implementation + feedback response graded on 3-point scale</td>
</tr>
<tr class="odd">
<td><strong>Midterm: House Prediction Competition</strong></td>
<td>15%</td>
<td>Team-based modeling competition with lightning presentations</td>
</tr>
<tr class="even">
<td><strong>Final Modeling Challenge</strong></td>
<td>25%</td>
<td>Real-world policy problem requiring model selection and justification</td>
</tr>
<tr class="odd">
<td><strong>Participation &amp; Weekly Notes</strong></td>
<td>5%</td>
<td>Attendance, engagement, and weekly learning documentation</td>
</tr>
</tbody>
</table>
<section id="lab-assignment-structure" class="level3">
<h3 class="anchored" data-anchor-id="lab-assignment-structure">Lab Assignment Structure</h3>
<p><strong>Philosophy:</strong> Lab assignments assess coding implementation, documentation, and professional response to feedback. Knowledge of underlying concepts is evaluated through weekly quizzes. Ultimately, the labs will form your final portfolio for this course so the amount of effort you put into each assignment is for your own benefit.</p>
<p><strong>Lab Assignment Structure:</strong></p>
<p>Labs 1, 2, 4, and 5 are individual assignments. <strong>Lab 3 (House Prediction)</strong> is completed in teams of 3-4 students.</p>
<p><strong>Assignment Sequence:</strong></p>
<ol type="1">
<li><strong>Census Data Exploration</strong> (Individual)</li>
<li><strong>Neighborhood Indicators</strong> (Individual)</li>
<li><strong>House Price Prediction Competition</strong> (Team-based) - <em>Serves as Midterm</em></li>
<li><strong>Parole Reform Analysis</strong> - Logistic Regression (Individual)</li>
<li><strong>Bike Share Rebalancing</strong> - Space-Time Modeling (Individual)</li>
</ol>
<p><strong>Final Modeling Challenge:</strong> Teams work on a real-world policy problem and choose the most appropriate modeling approach from the semester (linear regression, count models, logistic regression, or space-time modeling). The challenge emphasizes problem framing, methodology justification, and complete workflow implementation.</p>
<p><strong>GitHub-Based Feedback Response:</strong> Each assignment (after the first) must include a <code>feedback-response.md</code> file addressing: - How you incorporated previous TA feedback - Specific improvements made to visual clarity of figures, documentation, writeups - Challenges encountered and solutions attempted - Questions or areas needing clarification</p>
<p><strong>Weekly Notes Requirement:</strong> Students maintain a <code>weekly-notes/</code> folder in their GitHub repo with files named <code>week-XX-notes.md</code>. Notes should include: - Key concepts from lecture and readings - Coding techniques learned and challenges faced - Questions or confusion points - Connections to previous weeks or policy applications - Personal reflections on the material</p>
<p><em>Notes are checked weekly for completion and effort (not accuracy) and serve as quiz preparation aids.</em></p>
<p><strong>Lab Grading Scale:</strong></p>
<ul>
<li><strong>2 points:</strong> Complete implementation + feedback incorporation + clear documentation.</li>
<li><strong>1 point:</strong> Somewhat complete, poor feedback integration or unclear work</li>
<li><strong>0 points:</strong> Not submitted, incomplete, or no evidence of engaging with feedback</li>
</ul>
<p><strong>Weekly Quiz:</strong> AI advancements have changed how I view assessment. I am no longer concerned about students ability to complete coding-based assignments. AI, while certainly not perfect, will generally produce a solution to assignment prompts. My major concern now is how well students are able to really comprehend the concepts and fundamentals of what is being done in order to be appropriate critics of what AI produces.</p>
<p>Therefore, each class period will begin with an in-person, written quiz on material from the prior week or the prior lab assignment. There will be a total of 10 quizzes, but I will drop the lowest one.</p>
</section>
</section>
<section id="course-format" class="level2">
<h2 class="anchored" data-anchor-id="course-format">Course Format</h2>
<p><strong>Structure:</strong> Each 3-hour session combines conceptual lectures with hands-on labs</p>
<p><strong>Expectations:</strong></p>
<ul>
<li>Bring charged laptops for live coding and group work</li>
<li>Maintain weekly Quarto-based portfolio with reflections and notes (<em>ideally</em> students will take written notes and then transfer these to quarto after class for optimal retainment.)</li>
<li>Revise past work based on TA feedback for portfolio improvement</li>
<li>Engage actively in discussions and collaborative problem-solving</li>
<li>Attend class!</li>
</ul>
<p><strong>Technology:</strong> All work will be completed in R using Quarto for reproducible, professional documentation.</p>
<p><strong>GitHub Classroom:</strong> We will use GitHub Classroom for assignment distribution and submission. Each assignment creates a personal repository containing starter materials and instructions. Students customize, complete, and push their work to GitHub. This workflow builds professional version control skills while enabling efficient feedback and collaboration.</p>
<hr>
</section>
<section id="weekly-schedule" class="level2">
<h2 class="anchored" data-anchor-id="weekly-schedule">Weekly Schedule</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th>Week</th>
<th>Date</th>
<th>Topic</th>
<th>Assessment</th>
<th>Lab Assignment</th>
<th>GitHub Deliverables</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Sep 8</td>
<td>Course Intro • Quarto &amp; GitHub Setup • R Review</td>
<td>—</td>
<td>Setup &amp; Portfolio Init</td>
<td>Initial repo + Week 1 notes</td>
</tr>
<tr class="even">
<td>2</td>
<td>Sep 15</td>
<td>Census Data + Wrangling • Basic Visualization</td>
<td>Q1</td>
<td><strong>Lab 1 Start:</strong> Census Exploration</td>
<td>Week 2 notes + Lab 1 progress</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Sep 22</td>
<td>EDA • Visual Design Foundations</td>
<td>Q2</td>
<td>Lab 1 continued</td>
<td>Week 3 notes + Lab 1 progress</td>
</tr>
<tr class="even">
<td>4</td>
<td>Sep 29</td>
<td>Spatial Operations • Neighborhood Indicators</td>
<td>Q3</td>
<td><strong>Lab 1 Due</strong> + <strong>Lab 2 Start</strong></td>
<td>Week 4 notes + Lab 1 final + Lab 2 start</td>
</tr>
<tr class="odd">
<td>5</td>
<td>Oct 6</td>
<td>Linear Regression I • Making Predictions</td>
<td>Q4</td>
<td>Lab 2 continued</td>
<td>Week 5 notes + Lab 2 progress</td>
</tr>
<tr class="even">
<td>6</td>
<td>Oct 13</td>
<td>Linear Regression II • Model Evaluation</td>
<td>Q5</td>
<td><strong>Lab 2 Due</strong> + <strong>Lab 3 Start</strong> (Teams)</td>
<td>Week 6 notes + Lab 2 final + Lab 3 start</td>
</tr>
<tr class="odd">
<td>7</td>
<td>Oct 20</td>
<td>Spatial Autocorrelation • Intro to Spatial ML</td>
<td>Q5</td>
<td><strong>Lab 3 Continue</strong> (Teams)</td>
<td>Week 7 notes + Lab 2 final + Lab 3 start</td>
</tr>
<tr class="even">
<td>8</td>
<td>Oct 27</td>
<td><strong>House Prediction Presentations</strong> + Count Models-Predictive Policing</td>
<td><strong>Competition Presentations</strong></td>
<td><strong>Lab 3 Due</strong></td>
<td>Week 8 notes + Lab 3 final + presentations</td>
</tr>
<tr class="odd">
<td>9</td>
<td>Nov 3</td>
<td>Logistic Regression I • Geographic Cross-Validation</td>
<td>Q6</td>
<td></td>
<td>Week 9 notes</td>
</tr>
<tr class="even">
<td>10</td>
<td>Nov 10</td>
<td>Logistic Regression II • Recidivism Case Study</td>
<td>Q7</td>
<td><strong>Lab 4 Start:</strong> Parole Reform Analysis</td>
<td>Week 10 notes + Lab 4 start</td>
</tr>
<tr class="odd">
<td>11</td>
<td>Nov 17</td>
<td>Space-Time Modeling • Temporal Analysis</td>
<td>Q8</td>
<td><strong>Lab 4 Due</strong> + <strong>Lab 5 Start:</strong> Bike Share</td>
<td>Week 11 notes + Lab 4 final + Lab 5 start</td>
</tr>
<tr class="even">
<td>12</td>
<td>Nov 24</td>
<td>Text Analysis + *k*-means clustering. Final Challenge Introduced in Class</td>
<td>Q9</td>
<td>Lab 5 continued</td>
<td>Week 12 notes + Lab 5 start</td>
</tr>
<tr class="odd">
<td>13</td>
<td>Dec 1</td>
<td><strong>Final Challenge Continued - Teams work in class.</strong></td>
<td>Q10</td>
<td>Lab 5 Due</td>
<td>Lab 5 final</td>
</tr>
<tr class="even">
<td>14</td>
<td>Dec 8</td>
<td><strong>Final Challenge Presentations</strong></td>
<td></td>
<td></td>
<td>Final Challenge Deliverables Due in 1 week.</td>
</tr>
</tbody>
</table>
<hr>
</section>
<section id="academic-integrity-ai-policy" class="level2">
<h2 class="anchored" data-anchor-id="academic-integrity-ai-policy">Academic Integrity &amp; AI Policy</h2>
<section id="core-principle" class="level3">
<h3 class="anchored" data-anchor-id="core-principle">Core Principle</h3>
<p>All written work must be in your own words and demonstrate your understanding of concepts.</p>
</section>
<section id="ai-tool-guidelines" class="level3">
<h3 class="anchored" data-anchor-id="ai-tool-guidelines">AI Tool Guidelines</h3>
<ul>
<li><strong>Permitted:</strong> Using AI for debugging code, understanding error messages, understanding or decoding samples.</li>
<li><strong>Not Permitted:</strong> Copying/pasting AI-generated text for assignments, having AI complete entire problems. Using AI to interpret your results or do your data analysis. Providing responses suggested by AI that you do not fully understand.</li>
<li><strong>Quiz Preparation:</strong> Use AI to help understand concepts, but ensure you can explain ideas without assistance</li>
</ul>
<hr>
</section>
</section>
<section id="additional-faq-information" class="level2">
<h2 class="anchored" data-anchor-id="additional-faq-information">Additional FAQ Information</h2>
<p><strong>Late Assignments</strong>: Please turn in your assignments on time. I do very much understand that you have many other courses and I’ve done by best to make the required work reasonable. However, the concepts in this course build on each other and therefore assignments need to be turn in on time.</p>
<p><strong>Revising &amp; Resubmitting Assignments</strong>: I’ve minimized the grading of assignments for reasons outlined above. You’ll receive general feedback on how to improve in future work, but as long as you complete the assignment and continue to improve, you’ll ‘pass’ the assignment. Therefore, there is no option to revise and resubmit for a higher grade.</p>
<p><strong>Academic Integrity</strong>: <a href="https://catalog.upenn.edu/pennbook/code-of-academic-integrity/"><em>Please see the university policy on academic integrity</em></a>. Cases of academic dishonesty on assignments will result in a score of 0 on the assignment.</p>
<p><strong>Policy:</strong> 24-hour response time goal. For coding issues, please share your repository link or create a GitHub Issue for technical problems.</p>
<hr>
<p><em>This syllabus may be modified during the semester. Check Canvas for the most current version.</em></p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>